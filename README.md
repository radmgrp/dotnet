# dotnet

1 - выкачать любой код любого проекта (язык проекта не принципиально, будет плюсом если .Net Core)

2 - собрать проект в сборочном образе

3 - запустить тестирование проекта

4 - поместить собранный проект в docker-образ (не тот который для сборки а упрощенный который требуется для запуска и работы проекта)

5 - положить артефакт сборки проекта и docker образ во внешнее хранилище

6 - отправить webhook во внешнюю систему о результате завершения работы

Я сделал два варианта
1) Все этапы отдельно в Docker-in-Docker (.gitlab-ci.v1) 
2) Сборка одним этапом в мультистейдж Докер-файле (.gitlab-ci.v2)

* врокфлоу и генерацию тегов не прописывал т.к. не было в задаче

Для сборки используется кастомный образ radmgrp/sdk:8.0 (см. Dockerfile.sdk) поскольку этот проект требует дополнительных пекетов которых нет в mcr.microsoft.com/dotnet/sdk:8.0
каждый раз их подтягивать неправильно  - обычно базовые образы делаются под проект
но если нет доверия - просто замените и раскомментируйте шаги доустановки пакетов в .gitlab-ci.yml

На стороне Gitlab необходим раннер с тегом docker 


Необходимые переменные:

DOCKERHUB_USERNAME - имя аккаунта на Dockerhub


$KANIKO_CONFIG  - конфиг для авторизации на dockerhub

```json
{
  "auths": {
    "https://index.docker.io/v1/": {
      "auth": "XXXXXXXXX"
    }
  }
}
```

замените конфиг выводом команды 

```bash
echo -n dockerhub_user:password | base64
```


$SLACK_WEBHOOK_URL  - для отправки в Slack


Для проверки:
- запускаем собранный докер-образ

``` bash

docker run -p 8080:8080 $DOCKERHUB_USERNAME/dotnet:latest

```

- заходим по адресу http://localhost:8080/forecast
